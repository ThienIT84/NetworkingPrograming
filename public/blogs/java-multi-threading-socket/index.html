<!DOCTYPE html>
<html lang="vi">

<head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta http-equiv="Accept-CH" content="DPR, Viewport-Width, Width">
<link rel="icon" href=/NetworkingPrograming/fav.png type="image/gif">


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload"
      as="style"
      href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
>
<link rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
      media="print" onload="this.media='all'" />
<noscript>
  <link
          href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
          rel="stylesheet">
</noscript>


<link rel="stylesheet" href="/NetworkingPrograming/css/font.css" media="all">



<meta property="og:url" content="https://ThienIT84.github.io/NetworkingPrograming/blogs/java-multi-threading-socket/">
  <meta property="og:site_name" content="Trần Thanh Thiện - AI Engineer Portfolio">
  <meta property="og:title" content="Xử lý đa luồng: Để Server phục vụ hàng ngàn khách hàng">
  <meta property="og:description" content="Tìm hiểu chi tiết về Multi-threading trong Java, cách xây dựng Server có khả năng xử lý đồng thời nhiều Client, và các mô hình concurrency phổ biến.">
  <meta property="og:locale" content="vi">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blogs">
    <meta property="article:published_time" content="2025-12-19T14:00:00+07:00">
    <meta property="article:modified_time" content="2025-12-19T14:00:00+07:00">
    <meta property="article:tag" content="Java">
    <meta property="article:tag" content="Thread">
    <meta property="article:tag" content="Socket">
    <meta property="article:tag" content="Concurrency">
    <meta property="article:tag" content="Performance">


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Xử lý đa luồng: Để Server phục vụ hàng ngàn khách hàng">
  <meta name="twitter:description" content="Tìm hiểu chi tiết về Multi-threading trong Java, cách xây dựng Server có khả năng xử lý đồng thời nhiều Client, và các mô hình concurrency phổ biến.">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous"><link rel="stylesheet" href="/NetworkingPrograming/css/header.css" media="all">
<link rel="stylesheet" href="/NetworkingPrograming/css/footer.css" media="all">


<link rel="stylesheet" href="/NetworkingPrograming/css/theme.css" media="all">

<style>
    :root {
        --text-color: #343a40;
        --text-secondary-color: #6c757d;
        --text-link-color: #1e40af;
        --background-color: #eaedf0;
        --secondary-background-color: #64ffda1a;
        --primary-color: #2563eb;
        --secondary-color: #f8f9fa;

         
        --text-color-dark: #e2e8f0;
        --text-secondary-color-dark: #b0b3b8;
        --text-link-color-dark: #8b5cf6;
        --background-color-dark: #0f172a;
        --secondary-background-color-dark: #1e293b;
        --primary-color-dark: #06b6d4;
        --secondary-color-dark: #212529;
    }
    body {
        font-size: 1rem;
        font-weight: 400;
        line-height: 1.6;
        text-align: left;
    }

    html {
        background-color: var(--background-color) !important;
    }

    body::-webkit-scrollbar {
        height: 0px;
        width: 8px;
        background-color: var(--background-color);
    }

    ::-webkit-scrollbar-track {
        border-radius: 1rem;
    }

    ::-webkit-scrollbar-thumb {
        border-radius: 1rem;
        background: #b0b0b0;
        outline: 1px solid var(--background-color);
    }

    #search-content::-webkit-scrollbar {
        width: .5em;
        height: .1em;
        background-color: var(--background-color);
    }
</style>



<meta name="description" content="Tìm hiểu chi tiết về Multi-threading trong Java, cách xây dựng Server có khả năng xử lý đồng thời nhiều Client, và các mô hình concurrency phổ biến.">
<link rel="stylesheet" href="/NetworkingPrograming/css/single.css">


<script defer src="/NetworkingPrograming/fontawesome-6/all-6.4.2.js"></script>


    
    
    
    
    <link rel="stylesheet" href="/NetworkingPrograming/css/custom-blog.css">

    <title>
Xử lý đa luồng: Để Server phục vụ hàng ngàn khách hàng | Trần Thanh Thiện - AI Engineer Portfolio

    </title>
</head>

<body class="light">
    
    
<script>
    let localStorageValue = localStorage.getItem("pref-theme");
    let mediaQuery = window.matchMedia('(prefers-color-scheme: dark)').matches;

    switch (localStorageValue) {
        case "dark":
            document.documentElement.classList.add('dark');
            document.body.classList.add('dark');
            break;
        case "light":
            document.body.classList.remove('dark');
            document.documentElement.classList.remove('dark');
            break;
        default:
            if (mediaQuery) {
                document.documentElement.classList.add('dark');
                document.body.classList.add('dark');
            }
            break;
    }
</script>




<script>
    var prevScrollPos = window.pageYOffset;
    window.addEventListener("scroll", function showHeaderOnScroll() {
        let profileHeaderElem = document.getElementById("profileHeader");
        let currentScrollPos = window.pageYOffset;
        let resetHeaderStyle = false;
        let showNavBarOnScrollUp =  true ;
        let showNavBar = showNavBarOnScrollUp ? prevScrollPos > currentScrollPos : currentScrollPos > 0;
        if (showNavBar) {
            profileHeaderElem.classList.add("showHeaderOnTop");
        } else {
            resetHeaderStyle = true;
        }
        if(currentScrollPos === 0) {
            resetHeaderStyle = true;
        }
        if(resetHeaderStyle) {
            profileHeaderElem.classList.remove("showHeaderOnTop");
        }
        prevScrollPos = currentScrollPos;
    });
</script>



<header id="profileHeader">
    <nav class="pt-3 navbar navbar-expand-lg animate">
        <div class="container-fluid mx-xs-2 mx-sm-5 mx-md-5 mx-lg-5">
            
            <a class="navbar-brand primary-font text-wrap" href="/NetworkingPrograming">
                
                <img src="/NetworkingPrograming/fav.png" width="30" height="30"
                    class="d-inline-block align-top">
                Thien.Dev
                
            </a>

            

            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
                aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
                <svg aria-hidden="true" height="24" viewBox="0 0 16 16" version="1.1" width="24" data-view-component="true">
                    <path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z"></path>
                </svg>
            </button>

            
            <div class="collapse navbar-collapse text-wrap primary-font" id="navbarContent">
                <ul class="navbar-nav ms-auto text-center">
                    

                    

                    

                    

                    

                    

                    

                    

                    
                    
                    
                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/NetworkingPrograming/#about" title="">
                            
                            Giới thiệu
                        </a>
                    </li>
                    
                    
                    
                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/NetworkingPrograming/#experience" title="">
                            
                            Kinh nghiệm
                        </a>
                    </li>
                    
                    
                    
                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/NetworkingPrograming/#education" title="">
                            
                            Học vấn
                        </a>
                    </li>
                    
                    
                    
                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/NetworkingPrograming/#projects" title="">
                            
                            Dự án Nổi bật
                        </a>
                    </li>
                    
                    
                    
                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/NetworkingPrograming/#achievements" title="">
                            
                            Chứng chỉ
                        </a>
                    </li>
                    
                    
                    
                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/NetworkingPrograming/blogs/" title="">
                            
                            Blog
                        </a>
                    </li>
                    
                    
                    
                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/NetworkingPrograming/#contact" title="">
                            
                            Liên hệ
                        </a>
                    </li>
                    
                    

                    
                    <li class="nav-item navbar-text">
                        
                        <div class="text-center">
                            <button id="theme-toggle">
                                <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                                </svg>
                                <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="5"></circle>
                                    <line x1="12" y1="1" x2="12" y2="3"></line>
                                    <line x1="12" y1="21" x2="12" y2="23"></line>
                                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                    <line x1="1" y1="12" x2="3" y2="12"></line>
                                    <line x1="21" y1="12" x2="23" y2="12"></line>
                                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                                </svg>
                            </button>
                        </div>
                    </li>
                    

                </ul>

            </div>
        </div>
    </nav>
</header>
<div id="content">
<section id="single">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-sm-12 col-md-12 col-lg-9">
        <div class="pr-lg-4">
          <div class="title mb-5">
            <h1 class="text-center mb-4">Xử lý đa luồng: Để Server phục vụ hàng ngàn khách hàng</h1>
            <div class="text-center">
              
              19/12/2025

              
              <span id="readingTime">
                phút đọc
              </span>
              
            </div>
          </div>
          
          <div class="featured-image">
            <img class="img-fluid mx-auto d-block" src="/NetworkingPrograming/images/projects/multithread.png" alt="Xử lý đa luồng: Để Server phục vụ hàng ngàn khách hàng">
          </div>
          
          <article class="page-content  p-2">
          <h2 id="giới-thiệu">Giới thiệu</h2>
<p>Một Server chỉ có thể phục vụ một Client tại một thời điểm là hoàn toàn không khả thi trong thực tế. Hãy tưởng tượng Facebook, Zalo hay bất kỳ ứng dụng chat nào chỉ cho phép một người dùng đăng nhập tại một thời điểm - điều đó sẽ là thảm họa! Bài viết này sẽ giải thích chi tiết về <strong>Multi-threading</strong> (Đa luồng) - giải pháp cho phép Server xử lý hàng nghìn kết nối đồng thời.</p>
<h2 id="1-vấn-đề-của-server-đơn-luồng">1. Vấn đề của Server đơn luồng</h2>
<h3 id="11-phân-tích-kỹ-thuật">1.1. Phân tích kỹ thuật</h3>
<p>Khi một Server TCP đơn giản chạy trong một luồng duy nhất (single-threaded), nó gặp phải vấn đề <strong>blocking I/O</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">true</span>) {
</span></span><span style="display:flex;"><span>    Socket client <span style="color:#f92672">=</span> serverSocket.<span style="color:#a6e22e">accept</span>(); <span style="color:#75715e">// BLOCKING POINT 1</span>
</span></span><span style="display:flex;"><span>    BufferedReader in <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedReader(
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> InputStreamReader(client.<span style="color:#a6e22e">getInputStream</span>())
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    String message <span style="color:#f92672">=</span> in.<span style="color:#a6e22e">readLine</span>(); <span style="color:#75715e">// BLOCKING POINT 2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Xử lý message...</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>Vấn đề xảy ra:</strong></p>
<ol>
<li><strong>Tại accept()</strong>: Server bị &ldquo;đóng băng&rdquo; cho đến khi có Client kết nối</li>
<li><strong>Tại readLine()</strong>: Nếu Client A đã kết nối nhưng chưa gửi dữ liệu, Server sẽ chờ mãi và không thể accept() Client B</li>
</ol>
<p>Kết quả: Chỉ có thể phục vụ <strong>một Client tại một thời điểm</strong> - hoàn toàn không thực tế!</p>
<h3 id="12-minh-họa-thực-tế">1.2. Minh họa thực tế</h3>
<p>Giả sử bạn xây dựng một ứng dụng chat room:</p>
<ul>
<li>Client A kết nối và đang gõ tin nhắn (chưa gửi)</li>
<li>Client B, C, D cố gắng kết nối</li>
<li>Kết quả: B, C, D phải chờ đến khi A gửi tin nhắn và ngắt kết nối</li>
</ul>
<p>Điều này rõ ràng là không chấp nhận được!</p>
<h2 id="2-giải-pháp-multi-threading">2. Giải pháp: Multi-threading</h2>
<h3 id="21-ý-tưởng-cốt-lõi">2.1. Ý tưởng cốt lõi</h3>
<p><strong>Mỗi Client một Thread riêng biệt</strong>. Khi có kết nối mới:</p>
<ol>
<li>Main thread tiếp tục lắng nghe (<code>accept()</code>) các kết nối mới</li>
<li>Mỗi kết nối được xử lý bởi một Worker thread độc lập</li>
<li>Các thread chạy song song, không chặn lẫn nhau</li>
</ol>
<h3 id="22-kiến-trúc-hệ-thống">2.2. Kiến trúc hệ thống</h3>
<pre tabindex="0"><code>Main Thread (Listener)
    │
    ├─&gt; accept() Client 1 ──&gt; Worker Thread 1
    │
    ├─&gt; accept() Client 2 ──&gt; Worker Thread 2
    │
    ├─&gt; accept() Client 3 ──&gt; Worker Thread 3
    │
    └─&gt; accept() Client N ──&gt; Worker Thread N
</code></pre><h2 id="3-triển-khai-multi-threaded-server">3. Triển khai Multi-threaded Server</h2>
<h3 id="31-cấu-trúc-tổng-quan">3.1. Cấu trúc tổng quan</h3>
<p>Chúng ta cần hai class chính:</p>
<ol>
<li><strong>MultiThreadedServer</strong>: Main thread lắng nghe kết nối</li>
<li><strong>ClientHandler</strong>: Worker thread xử lý từng Client</li>
</ol>
<h3 id="32-code-server-chính">3.2. Code Server chính</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.net.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.concurrent.*;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MultiThreadedServer</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> PORT <span style="color:#f92672">=</span> 8888;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> MAX_THREADS <span style="color:#f92672">=</span> 100;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Thread pool để quản lý threads hiệu quả</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> ExecutorService threadPool <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>        Executors.<span style="color:#a6e22e">newFixedThreadPool</span>(MAX_THREADS);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;=== Multi-threaded Server Starting ===&#34;</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> (ServerSocket serverSocket <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServerSocket(PORT)) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Server đang lắng nghe tại port: &#34;</span> <span style="color:#f92672">+</span> PORT);
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Tối đa &#34;</span> <span style="color:#f92672">+</span> MAX_THREADS <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; kết nối đồng thời&#34;</span>);
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> clientCount <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Vòng lặp vô hạn để chấp nhận kết nối</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">true</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// Chờ kết nối mới (blocking, nhưng không sao vì đây là main thread)</span>
</span></span><span style="display:flex;"><span>                    Socket clientSocket <span style="color:#f92672">=</span> serverSocket.<span style="color:#a6e22e">accept</span>();
</span></span><span style="display:flex;"><span>                    clientCount<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n[&#34;</span> <span style="color:#f92672">+</span> clientCount <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;] Client mới kết nối:&#34;</span>);
</span></span><span style="display:flex;"><span>                    System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;    IP: &#34;</span> <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>                        clientSocket.<span style="color:#a6e22e">getInetAddress</span>().<span style="color:#a6e22e">getHostAddress</span>());
</span></span><span style="display:flex;"><span>                    System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;    Port: &#34;</span> <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>                        clientSocket.<span style="color:#a6e22e">getPort</span>());
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// Tạo handler và submit vào thread pool</span>
</span></span><span style="display:flex;"><span>                    ClientHandler handler <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ClientHandler(clientSocket, clientCount);
</span></span><span style="display:flex;"><span>                    threadPool.<span style="color:#a6e22e">execute</span>(handler);
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;    ✓ Đã giao cho Worker Thread xử lý&#34;</span>);
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>                    System.<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Lỗi khi chấp nhận kết nối: &#34;</span> <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Không thể khởi động Server: &#34;</span> <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>            e.<span style="color:#a6e22e">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            threadPool.<span style="color:#a6e22e">shutdown</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="33-code-clienthandler">3.3. Code ClientHandler</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.net.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.time.LocalDateTime;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.time.format.DateTimeFormatter;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ClientHandler</span> <span style="color:#66d9ef">implements</span> Runnable {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Socket clientSocket;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> clientId;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> BufferedReader in;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> PrintWriter out;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ClientHandler</span>(Socket socket, <span style="color:#66d9ef">int</span> id) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">clientSocket</span> <span style="color:#f92672">=</span> socket;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">clientId</span> <span style="color:#f92672">=</span> id;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span>() {
</span></span><span style="display:flex;"><span>        String threadName <span style="color:#f92672">=</span> Thread.<span style="color:#a6e22e">currentThread</span>().<span style="color:#a6e22e">getName</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;[Client &#34;</span> <span style="color:#f92672">+</span> clientId <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;] Handler bắt đầu trên &#34;</span> <span style="color:#f92672">+</span> threadName);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Khởi tạo streams</span>
</span></span><span style="display:flex;"><span>            in <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedReader(
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">new</span> InputStreamReader(clientSocket.<span style="color:#a6e22e">getInputStream</span>())
</span></span><span style="display:flex;"><span>            );
</span></span><span style="display:flex;"><span>            out <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> PrintWriter(
</span></span><span style="display:flex;"><span>                clientSocket.<span style="color:#a6e22e">getOutputStream</span>(), <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>            );
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Gửi thông báo chào mừng</span>
</span></span><span style="display:flex;"><span>            out.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;=== Chào mừng đến Server ===&#34;</span>);
</span></span><span style="display:flex;"><span>            out.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Bạn là Client #&#34;</span> <span style="color:#f92672">+</span> clientId);
</span></span><span style="display:flex;"><span>            out.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Thread xử lý: &#34;</span> <span style="color:#f92672">+</span> threadName);
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Vòng lặp xử lý tin nhắn</span>
</span></span><span style="display:flex;"><span>            String message;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> ((message <span style="color:#f92672">=</span> in.<span style="color:#a6e22e">readLine</span>()) <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                String timestamp <span style="color:#f92672">=</span> LocalDateTime.<span style="color:#a6e22e">now</span>()
</span></span><span style="display:flex;"><span>                    .<span style="color:#a6e22e">format</span>(DateTimeFormatter.<span style="color:#a6e22e">ofPattern</span>(<span style="color:#e6db74">&#34;HH:mm:ss&#34;</span>));
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;[&#34;</span> <span style="color:#f92672">+</span> timestamp <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;][Client &#34;</span> <span style="color:#f92672">+</span> clientId <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;] &#34;</span> <span style="color:#f92672">+</span> message);
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Kiểm tra lệnh thoát</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (message.<span style="color:#a6e22e">equalsIgnoreCase</span>(<span style="color:#e6db74">&#34;bye&#34;</span>) <span style="color:#f92672">||</span> 
</span></span><span style="display:flex;"><span>                    message.<span style="color:#a6e22e">equalsIgnoreCase</span>(<span style="color:#e6db74">&#34;exit&#34;</span>)) {
</span></span><span style="display:flex;"><span>                    out.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Tạm biệt! Ngắt kết nối...&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Echo lại tin nhắn với timestamp</span>
</span></span><span style="display:flex;"><span>                out.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;[&#34;</span> <span style="color:#f92672">+</span> timestamp <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;] Server nhận: &#34;</span> <span style="color:#f92672">+</span> message);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;[Client &#34;</span> <span style="color:#f92672">+</span> clientId <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;] Lỗi I/O: &#34;</span> <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            cleanup();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">cleanup</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (in <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) in.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (out <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) out.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (clientSocket <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>clientSocket.<span style="color:#a6e22e">isClosed</span>()) {
</span></span><span style="display:flex;"><span>                clientSocket.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;[Client &#34;</span> <span style="color:#f92672">+</span> clientId <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;] Đã ngắt kết nối&#34;</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;[Client &#34;</span> <span style="color:#f92672">+</span> clientId <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;] Lỗi khi đóng kết nối: &#34;</span> 
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="4-thread-pool-vs-thread-mới-mỗi-lần">4. Thread Pool vs. Thread mới mỗi lần</h2>
<h3 id="41-cách-tiếp-cận-cũ-không-khuyến-khích">4.1. Cách tiếp cận cũ (Không khuyến khích)</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Tạo thread mới mỗi khi có kết nối</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">new</span> Thread(<span style="color:#66d9ef">new</span> ClientHandler(socket, clientId)).<span style="color:#a6e22e">start</span>();
</span></span></code></pre></div><p><strong>Vấn đề:</strong></p>
<ul>
<li>Tạo thread rất tốn kém về tài nguyên (memory, CPU)</li>
<li>Nếu có 10,000 clients → 10,000 threads → Server crash!</li>
<li>Không kiểm soát được số lượng thread</li>
</ul>
<h3 id="42-cách-tiếp-cận-hiện-đại-khuyến-khích">4.2. Cách tiếp cận hiện đại (Khuyến khích)</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Sử dụng Thread Pool</span>
</span></span><span style="display:flex;"><span>ExecutorService threadPool <span style="color:#f92672">=</span> Executors.<span style="color:#a6e22e">newFixedThreadPool</span>(100);
</span></span><span style="display:flex;"><span>threadPool.<span style="color:#a6e22e">execute</span>(<span style="color:#66d9ef">new</span> ClientHandler(socket, clientId));
</span></span></code></pre></div><p><strong>Ưu điểm:</strong></p>
<ul>
<li>Giới hạn số lượng thread tối đa (ví dụ: 100)</li>
<li>Tái sử dụng thread (thread reuse) → hiệu quả hơn</li>
<li>Tự động quản lý vòng đời của thread</li>
<li>Có hàng đợi (queue) cho các task chờ xử lý</li>
</ul>
<h2 id="5-các-loại-thread-pool">5. Các loại Thread Pool</h2>
<p>Java cung cấp nhiều loại Thread Pool:</p>
<h3 id="51-fixedthreadpool">5.1. FixedThreadPool</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>ExecutorService pool <span style="color:#f92672">=</span> Executors.<span style="color:#a6e22e">newFixedThreadPool</span>(10);
</span></span></code></pre></div><ul>
<li>Số lượng thread cố định (ví dụ: 10)</li>
<li>Phù hợp khi biết trước tải (load) của hệ thống</li>
</ul>
<h3 id="52-cachedthreadpool">5.2. CachedThreadPool</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>ExecutorService pool <span style="color:#f92672">=</span> Executors.<span style="color:#a6e22e">newCachedThreadPool</span>();
</span></span></code></pre></div><ul>
<li>Tạo thread mới khi cần, tái sử dụng thread rảnh</li>
<li>Phù hợp cho nhiều task ngắn hạn</li>
</ul>
<h3 id="53-scheduledthreadpool">5.3. ScheduledThreadPool</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>ScheduledExecutorService pool <span style="color:#f92672">=</span> Executors.<span style="color:#a6e22e">newScheduledThreadPool</span>(5);
</span></span></code></pre></div><ul>
<li>Cho phép lập lịch task chạy định kỳ</li>
<li>Phù hợp cho các tác vụ bảo trì, cleanup</li>
</ul>
<h2 id="6-vấn-đề-đồng-bộ-hóa-synchronization">6. Vấn đề đồng bộ hóa (Synchronization)</h2>
<h3 id="61-race-condition">6.1. Race Condition</h3>
<p>Khi nhiều thread cùng truy cập một tài nguyên chung (ví dụ: danh sách clients), có thể xảy ra <strong>race condition</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// KHÔNG AN TOÀN!</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> List<span style="color:#f92672">&lt;</span>ClientHandler<span style="color:#f92672">&gt;</span> clients <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Thread 1 và Thread 2 cùng thêm vào list</span>
</span></span><span style="display:flex;"><span>clients.<span style="color:#a6e22e">add</span>(newClient); <span style="color:#75715e">// Có thể gây lỗi!</span>
</span></span></code></pre></div><h3 id="62-giải-pháp-synchronized-collections">6.2. Giải pháp: Synchronized Collections</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// AN TOÀN với multi-threading</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> List<span style="color:#f92672">&lt;</span>ClientHandler<span style="color:#f92672">&gt;</span> clients <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>    Collections.<span style="color:#a6e22e">synchronizedList</span>(<span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;</span>());
</span></span></code></pre></div><p>Hoặc sử dụng <strong>ConcurrentHashMap</strong>, <strong>CopyOnWriteArrayList</strong> từ package <code>java.util.concurrent</code>.</p>
<h2 id="7-ứng-dụng-thực-tế-chat-server">7. Ứng dụng thực tế: Chat Server</h2>
<p>Dưới đây là ví dụ về Chat Server cho phép broadcast tin nhắn đến tất cả clients:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.concurrent.*;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ChatServer</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> Set<span style="color:#f92672">&lt;</span>PrintWriter<span style="color:#f92672">&gt;</span> clientWriters <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>        ConcurrentHashMap.<span style="color:#a6e22e">newKeySet</span>();
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">broadcast</span>(String message, PrintWriter sender) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (PrintWriter writer : clientWriters) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (writer <span style="color:#f92672">!=</span> sender) { <span style="color:#75715e">// Không gửi lại cho người gửi</span>
</span></span><span style="display:flex;"><span>                writer.<span style="color:#a6e22e">println</span>(message);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">addClient</span>(PrintWriter writer) {
</span></span><span style="display:flex;"><span>        clientWriters.<span style="color:#a6e22e">add</span>(writer);
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Tổng số clients: &#34;</span> <span style="color:#f92672">+</span> clientWriters.<span style="color:#a6e22e">size</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">removeClient</span>(PrintWriter writer) {
</span></span><span style="display:flex;"><span>        clientWriters.<span style="color:#a6e22e">remove</span>(writer);
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Tổng số clients: &#34;</span> <span style="color:#f92672">+</span> clientWriters.<span style="color:#a6e22e">size</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="8-best-practices">8. Best Practices</h2>
<h3 id="81-xử-lý-ngoại-lệ-đúng-cách">8.1. Xử lý ngoại lệ đúng cách</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Code xử lý client</span>
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">catch</span> (SocketException e) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Client ngắt kết nối đột ngột</span>
</span></span><span style="display:flex;"><span>    System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Client disconnected abruptly&#34;</span>);
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Lỗi I/O khác</span>
</span></span><span style="display:flex;"><span>    e.<span style="color:#a6e22e">printStackTrace</span>();
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Luôn cleanup resources</span>
</span></span><span style="display:flex;"><span>    cleanup();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="82-timeout-để-tránh-thread-bị-treo">8.2. Timeout để tránh thread bị treo</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>clientSocket.<span style="color:#a6e22e">setSoTimeout</span>(30000); <span style="color:#75715e">// 30 giây timeout</span>
</span></span></code></pre></div><h3 id="83-graceful-shutdown">8.3. Graceful Shutdown</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Runtime.<span style="color:#a6e22e">getRuntime</span>().<span style="color:#a6e22e">addShutdownHook</span>(<span style="color:#66d9ef">new</span> Thread(() <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>    System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\nShutting down server...&#34;</span>);
</span></span><span style="display:flex;"><span>    threadPool.<span style="color:#a6e22e">shutdown</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>threadPool.<span style="color:#a6e22e">awaitTermination</span>(60, TimeUnit.<span style="color:#a6e22e">SECONDS</span>)) {
</span></span><span style="display:flex;"><span>            threadPool.<span style="color:#a6e22e">shutdownNow</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>        threadPool.<span style="color:#a6e22e">shutdownNow</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}));
</span></span></code></pre></div><h2 id="9-hiệu-năng-và-scalability">9. Hiệu năng và Scalability</h2>
<h3 id="91-giới-hạn-của-thread-per-client">9.1. Giới hạn của Thread-per-Client</h3>
<p>Mô hình này có giới hạn:</p>
<ul>
<li>Mỗi thread tiêu tốn ~1MB memory</li>
<li>Hệ điều hành giới hạn số lượng thread (thường ~10,000)</li>
<li>Context switching giữa nhiều thread tốn CPU</li>
</ul>
<h3 id="92-giải-pháp-nâng-cao-nio-non-blocking-io">9.2. Giải pháp nâng cao: NIO (Non-blocking I/O)</h3>
<p>Đối với hệ thống cần xử lý hàng chục nghìn kết nối đồng thời, nên sử dụng:</p>
<ul>
<li><strong>Java NIO</strong> (New I/O) với Selector</li>
<li><strong>Netty Framework</strong> - framework NIO mạnh mẽ</li>
<li><strong>Reactive Programming</strong> với Project Reactor</li>
</ul>
<h2 id="10-so-sánh-các-mô-hình">10. So sánh các mô hình</h2>
<table>
  <thead>
      <tr>
          <th>Mô hình</th>
          <th>Số Clients</th>
          <th>Độ phức tạp</th>
          <th>Hiệu năng</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Single-threaded</td>
          <td>1</td>
          <td>Thấp</td>
          <td>Kém</td>
      </tr>
      <tr>
          <td>Thread-per-Client</td>
          <td>~1,000</td>
          <td>Trung bình</td>
          <td>Tốt</td>
      </tr>
      <tr>
          <td>Thread Pool</td>
          <td>~10,000</td>
          <td>Trung bình</td>
          <td>Rất tốt</td>
      </tr>
      <tr>
          <td>NIO/Netty</td>
          <td>100,000+</td>
          <td>Cao</td>
          <td>Xuất sắc</td>
      </tr>
  </tbody>
</table>
<h2 id="kết-luận">Kết luận</h2>
<p>Multi-threading là kỹ thuật thiết yếu để xây dựng Server có khả năng mở rộng. Bằng cách sử dụng Thread Pool và các công cụ đồng bộ hóa phù hợp, chúng ta có thể xây dựng các ứng dụng mạng phục vụ hàng nghìn người dùng đồng thời một cách hiệu quả.</p>
<p>Trong bài viết tiếp theo, chúng ta sẽ tìm hiểu về giao thức UDP - một lựa chọn thay thế cho TCP trong các trường hợp cần tốc độ cao hơn độ tin cậy.</p>
<h2 id="tài-liệu-tham-khảo">Tài liệu tham khảo</h2>
<ul>
<li>&ldquo;Java Concurrency in Practice&rdquo; - Brian Goetz</li>
<li>Oracle Java Tutorials: <a href="https://docs.oracle.com/javase/tutorial/essential/concurrency/">Concurrency</a></li>
<li>&ldquo;Netty in Action&rdquo; - Norman Maurer</li>
<li>Doug Lea&rsquo;s Concurrent Programming in Java</li>
</ul>

          </article>
        </div>
      </div>
      <div class="col-sm-12 col-md-12 col-lg-3">
        <div id="stickySideBar" class="sticky-sidebar">
          
          <aside class="toc">
              <h5>
                Mục lục
              </h5>
              <div class="toc-content">
                <nav id="TableOfContents">
  <ul>
    <li><a href="#giới-thiệu">Giới thiệu</a></li>
    <li><a href="#1-vấn-đề-của-server-đơn-luồng">1. Vấn đề của Server đơn luồng</a>
      <ul>
        <li><a href="#11-phân-tích-kỹ-thuật">1.1. Phân tích kỹ thuật</a></li>
        <li><a href="#12-minh-họa-thực-tế">1.2. Minh họa thực tế</a></li>
      </ul>
    </li>
    <li><a href="#2-giải-pháp-multi-threading">2. Giải pháp: Multi-threading</a>
      <ul>
        <li><a href="#21-ý-tưởng-cốt-lõi">2.1. Ý tưởng cốt lõi</a></li>
        <li><a href="#22-kiến-trúc-hệ-thống">2.2. Kiến trúc hệ thống</a></li>
      </ul>
    </li>
    <li><a href="#3-triển-khai-multi-threaded-server">3. Triển khai Multi-threaded Server</a>
      <ul>
        <li><a href="#31-cấu-trúc-tổng-quan">3.1. Cấu trúc tổng quan</a></li>
        <li><a href="#32-code-server-chính">3.2. Code Server chính</a></li>
        <li><a href="#33-code-clienthandler">3.3. Code ClientHandler</a></li>
      </ul>
    </li>
    <li><a href="#4-thread-pool-vs-thread-mới-mỗi-lần">4. Thread Pool vs. Thread mới mỗi lần</a>
      <ul>
        <li><a href="#41-cách-tiếp-cận-cũ-không-khuyến-khích">4.1. Cách tiếp cận cũ (Không khuyến khích)</a></li>
        <li><a href="#42-cách-tiếp-cận-hiện-đại-khuyến-khích">4.2. Cách tiếp cận hiện đại (Khuyến khích)</a></li>
      </ul>
    </li>
    <li><a href="#5-các-loại-thread-pool">5. Các loại Thread Pool</a>
      <ul>
        <li><a href="#51-fixedthreadpool">5.1. FixedThreadPool</a></li>
        <li><a href="#52-cachedthreadpool">5.2. CachedThreadPool</a></li>
        <li><a href="#53-scheduledthreadpool">5.3. ScheduledThreadPool</a></li>
      </ul>
    </li>
    <li><a href="#6-vấn-đề-đồng-bộ-hóa-synchronization">6. Vấn đề đồng bộ hóa (Synchronization)</a>
      <ul>
        <li><a href="#61-race-condition">6.1. Race Condition</a></li>
        <li><a href="#62-giải-pháp-synchronized-collections">6.2. Giải pháp: Synchronized Collections</a></li>
      </ul>
    </li>
    <li><a href="#7-ứng-dụng-thực-tế-chat-server">7. Ứng dụng thực tế: Chat Server</a></li>
    <li><a href="#8-best-practices">8. Best Practices</a>
      <ul>
        <li><a href="#81-xử-lý-ngoại-lệ-đúng-cách">8.1. Xử lý ngoại lệ đúng cách</a></li>
        <li><a href="#82-timeout-để-tránh-thread-bị-treo">8.2. Timeout để tránh thread bị treo</a></li>
        <li><a href="#83-graceful-shutdown">8.3. Graceful Shutdown</a></li>
      </ul>
    </li>
    <li><a href="#9-hiệu-năng-và-scalability">9. Hiệu năng và Scalability</a>
      <ul>
        <li><a href="#91-giới-hạn-của-thread-per-client">9.1. Giới hạn của Thread-per-Client</a></li>
        <li><a href="#92-giải-pháp-nâng-cao-nio-non-blocking-io">9.2. Giải pháp nâng cao: NIO (Non-blocking I/O)</a></li>
      </ul>
    </li>
    <li><a href="#10-so-sánh-các-mô-hình">10. So sánh các mô hình</a></li>
    <li><a href="#kết-luận">Kết luận</a></li>
    <li><a href="#tài-liệu-tham-khảo">Tài liệu tham khảo</a></li>
  </ul>
</nav>
              </div>
          </aside>
          

          
          <aside class="tags">
            <h5>Tags</h5>
            <ul class="tags-ul list-unstyled list-inline">
              
              <li class="list-inline-item"><a href="https://ThienIT84.github.io/NetworkingPrograming/tags/Java"
                target="_blank"
              >Java</a></li>
              
              <li class="list-inline-item"><a href="https://ThienIT84.github.io/NetworkingPrograming/tags/Thread"
                target="_blank"
              >Thread</a></li>
              
              <li class="list-inline-item"><a href="https://ThienIT84.github.io/NetworkingPrograming/tags/Socket"
                target="_blank"
              >Socket</a></li>
              
              <li class="list-inline-item"><a href="https://ThienIT84.github.io/NetworkingPrograming/tags/Concurrency"
                target="_blank"
              >Concurrency</a></li>
              
              <li class="list-inline-item"><a href="https://ThienIT84.github.io/NetworkingPrograming/tags/Performance"
                target="_blank"
              >Performance</a></li>
              
            </ul>
          </aside>
          

          
          <aside class="social">
            <h5>Social</h5>
            <div class="social-content">
              <ul class="list-inline">
                <li class="list-inline-item text-center">
                  <a target="_blank" href="https://www.linkedin.com/feed/?shareActive=true&text=T%c3%acm%20hi%e1%bb%83u%20chi%20ti%e1%ba%bft%20v%e1%bb%81%20Multi-threading%20trong%20Java%2c%20c%c3%a1ch%20x%c3%a2y%20d%e1%bb%b1ng%20Server%20c%c3%b3%20kh%e1%ba%a3%20n%c4%83ng%20x%e1%bb%ad%20l%c3%bd%20%c4%91%e1%bb%93ng%20th%e1%bb%9di%20nhi%e1%bb%81u%20Client%2c%20v%c3%a0%20c%c3%a1c%20m%c3%b4%20h%c3%acnh%20concurrency%20ph%e1%bb%95%20bi%e1%ba%bfn. https%3a%2f%2fThienIT84.github.io%2fNetworkingPrograming%2fblogs%2fjava-multi-threading-socket%2f">
                    <i class="fab fa-linkedin"></i>
                  </a>
                </li>
                <li class="list-inline-item text-center">
                  <a target="_blank" href='https://twitter.com/share?text=X%e1%bb%ad%20l%c3%bd%20%c4%91a%20lu%e1%bb%93ng%3a%20%c4%90%e1%bb%83%20Server%20ph%e1%bb%a5c%20v%e1%bb%a5%20h%c3%a0ng%20ng%c3%a0n%20kh%c3%a1ch%20h%c3%a0ng&url=https%3a%2f%2fThienIT84.github.io%2fNetworkingPrograming%2fblogs%2fjava-multi-threading-socket%2f&hashtags=Java%2cThread%2cSocket%2cConcurrency%2cPerformance'>
                    <i class="fab fa-twitter"></i>
                  </a>
                </li>
                <li class="list-inline-item text-center">
                  <a target="_blank" href="https://api.whatsapp.com/send?text=X%e1%bb%ad%20l%c3%bd%20%c4%91a%20lu%e1%bb%93ng%3a%20%c4%90%e1%bb%83%20Server%20ph%e1%bb%a5c%20v%e1%bb%a5%20h%c3%a0ng%20ng%c3%a0n%20kh%c3%a1ch%20h%c3%a0ng: https%3a%2f%2fThienIT84.github.io%2fNetworkingPrograming%2fblogs%2fjava-multi-threading-socket%2f">
                    <i class="fab fa-whatsapp"></i>
                  </a>
                </li>
                <li class="list-inline-item text-center">
                  <a target="_blank" href='mailto:?subject=X%e1%bb%ad%20l%c3%bd%20%c4%91a%20lu%e1%bb%93ng%3a%20%c4%90%e1%bb%83%20Server%20ph%e1%bb%a5c%20v%e1%bb%a5%20h%c3%a0ng%20ng%c3%a0n%20kh%c3%a1ch%20h%c3%a0ng&amp;body=Check%20out%20this%20site https%3a%2f%2fThienIT84.github.io%2fNetworkingPrograming%2fblogs%2fjava-multi-threading-socket%2f'>
                    <i class="fa fa-envelope"></i>
                  </a>
                </li>
              </ul>
            </div>
          </aside>
          
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-12 col-lg-9 p-4">
        
      </div>
    </div>
  </div>
  <button class="p-2 px-3" onclick="topFunction()" id="topScroll">
    <i class="fas fa-angle-up"></i>
  </button>
</section>


<div class="progress">
  <div id="scroll-progress-bar" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
</div>
<Script src="/NetworkingPrograming/js/scrollProgressBar.js"></script>


<script>
  var topScroll = document.getElementById("topScroll");
  window.onscroll = function() {scrollFunction()};

  function scrollFunction() {
    if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
      topScroll.style.display = "block";
    } else {
      topScroll.style.display = "none";
    }
  }

  function topFunction() {
    document.body.scrollTop = 0;
    document.documentElement.scrollTop = 0;
  }

  
  let stickySideBarElem = document.getElementById("stickySideBar");
  let stickyNavBar =  true ;
  if(stickyNavBar) {
    let headerElem = document.getElementById("profileHeader");
    let headerHeight = headerElem.offsetHeight + 15;
    stickySideBarElem.style.top = headerHeight + "px";
  } else {
    stickySideBarElem.style.top = "50px";
  }
</script>


<script src="/NetworkingPrograming/js/readingTime.js"></script>



    </div><footer>
    
 
 
<div class="container py-3" id="recent-posts">
    
    
    <div class="h3 text-center text-secondary py-3">
        Bài viết mới
    </div>
    <div class="row justify-content-center">
        
        <div class="col-lg-4 col-md-6 pt-2">
            <div class="card h-100">
                
                <div class="card-header">
                    <a href="/NetworkingPrograming/blogs/safesense-vi-case-study/">
                        <img src="/NetworkingPrograming/images/projects/safesense-vi-banner.jpg" class="card-img-top" alt="SafeSense-Vi: Hành Trình 6 Tháng Săn Lùng 38K Comments Độc Hại Trên Mạng Xã Hội Việt Nam">
                    </a>
                </div>
                
                <div class="card-body bg-transparent p-3 shadow-sm">
                    <a href="/NetworkingPrograming/blogs/safesense-vi-case-study/" class="primary-font card-title">
                        <h5 class="card-title bg-transparent" title="SafeSense-Vi: Hành Trình 6 Tháng Săn Lùng 38K Comments Độc Hại Trên Mạng Xã Hội Việt Nam">SafeSense-Vi: Hành Trình …</h5>
                    </a>
                    <div class="card-text secondary-font">
                        <p><h2 id="-mở-đầu-khi-internet-việt-nam-trở-thành-chiến-trường">🎬 Mở Đầu: Khi Internet Việt Nam Trở Thành &ldquo;Chiến Trường&rdquo;</h2>
<p>Bạn có bao giờ lướt Facebook hay YouTube và thấy những bình luận kiểu này không?</p>
<blockquote>
<p><em>&ldquo;Bắc kỳ chó toàn lũ lừa đảo vcl&rdquo;</em><br>
<em>&ldquo;Con này béo như lợn, nhìn tởm đm&rdquo;</em><br>
<em>&ldquo;Thằng bê đê tởm lợm chết đi cho rồi&rdquo;</em></p>
</blockquote>
<p>Đây …</p></p>
                    </div>
                </div>
                <div class="mt-auto card-footer">
                    <span class="float-start">December 27, 2025</span>
                    <a href="/NetworkingPrograming/blogs/safesense-vi-case-study/" class="float-end btn btn-outline-info btn-sm">Đọc thêm</a>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 col-md-6 pt-2">
            <div class="card h-100">
                
                <div class="card-header">
                    <a href="/NetworkingPrograming/blogs/rag-system-case-study/">
                        <img src="/NetworkingPrograming/images/projects/RAG_chat-app.jpg" class="card-img-top" alt="Làm Sao để &#39;Chat&#39; với PDF? - Hành Trình Xây Dựng RAG System">
                    </a>
                </div>
                
                <div class="card-body bg-transparent p-3 shadow-sm">
                    <a href="/NetworkingPrograming/blogs/rag-system-case-study/" class="primary-font card-title">
                        <h5 class="card-title bg-transparent" title="Làm Sao để &#39;Chat&#39; với PDF? - Hành Trình Xây Dựng RAG System">Làm Sao để &#39;Chat&#39; với …</h5>
                    </a>
                    <div class="card-text secondary-font">
                        <p><h2 id="-vấn-đề-tôi-lười-đọc-sách">🤔 Vấn Đề: Tôi Lười Đọc Sách</h2>
<p>Hãy thành thật đi - ai cũng từng gặp tình huống này:</p>
<blockquote>
<p><strong>Giảng viên:</strong> &ldquo;Bài tập tuần này: Đọc 3 paper về Machine Learning, mỗi paper 20 trang.&rdquo;<br>
<strong>Tôi:</strong> &ldquo;Ơ&hellip; 60 trang? Chắc đọc lướt thôi&hellip;&rdquo;<br>
<strong>Kết quả:</strong> Thi xong không nhớ gì 😅</p>
</blockquote>
<p>Rồi một ngày, tôi …</p></p>
                    </div>
                </div>
                <div class="mt-auto card-footer">
                    <span class="float-start">December 27, 2025</span>
                    <a href="/NetworkingPrograming/blogs/rag-system-case-study/" class="float-end btn btn-outline-info btn-sm">Đọc thêm</a>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 col-md-6 pt-2">
            <div class="card h-100">
                
                <div class="card-header">
                    <a href="/NetworkingPrograming/blogs/prepro-toeic-case-study/">
                        <img src="/NetworkingPrograming/images/projects/prepro-toeic.jpg" class="card-img-top" alt="Từ Ý Tưởng Đến Sản Phẩm: Hành Trình Xây Dựng Nền Tảng Học TOEIC Thông Minh">
                    </a>
                </div>
                
                <div class="card-body bg-transparent p-3 shadow-sm">
                    <a href="/NetworkingPrograming/blogs/prepro-toeic-case-study/" class="primary-font card-title">
                        <h5 class="card-title bg-transparent" title="Từ Ý Tưởng Đến Sản Phẩm: Hành Trình Xây Dựng Nền Tảng Học TOEIC Thông Minh">Từ Ý Tưởng Đến Sản Phẩm: …</h5>
                    </a>
                    <div class="card-text secondary-font">
                        <p><h2 id="-mở-đầu-vấn-đề-cần-giải-quyết">🎬 Mở Đầu: Vấn Đề Cần Giải Quyết</h2>
<p>Bạn có bao giờ tự hỏi tại sao học TOEIC lại khó? Không phải vì thiếu tài liệu, mà vì <strong>quá nhiều tài liệu không có hệ thống</strong>. Học sinh thường gặp phải:</p>
<ul>
<li>📚 <strong>Ngân hàng câu hỏi rời rạc</strong>: Không biết nên luyện gì, luyện như thế nào</li>
<li>🔄 <strong>Thiếu phương pháp ôn tập khoa học</strong>: Học xong …</li></ul></p>
                    </div>
                </div>
                <div class="mt-auto card-footer">
                    <span class="float-start">December 27, 2025</span>
                    <a href="/NetworkingPrograming/blogs/prepro-toeic-case-study/" class="float-end btn btn-outline-info btn-sm">Đọc thêm</a>
                </div>
            </div>
        </div>
        
    </div>
</div>

<div class="text-center pt-2">
    
    <span class="px-1">
        <a href="https://github.com/ThienIT84" target="_blank" aria-label="github">
            <svg xmlns="http://www.w3.org/2000/svg" width="2.7em" height="2.7em" viewBox="0 0 1792 1792">
                <path id="footer-socialNetworks-github-svg-path"
                    d="M522 1352q-8 9-20-3-13-11-4-19 8-9 20 3 12 11 4 19zm-42-61q9 12 0 19-8 6-17-7t0-18q9-7 17 6zm-61-60q-5 7-13 2-10-5-7-12 3-5 13-2 10 5 7 12zm31 34q-6 7-16-3-9-11-2-16 6-6 16 3 9 11 2 16zm129 112q-4 12-19 6-17-4-13-15t19-7q16 5 13 16zm63 5q0 11-16 11-17 2-17-11 0-11 16-11 17-2 17 11zm58-10q2 10-14 14t-18-8 14-15q16-2 18 9zm964-956v960q0 119-84.5 203.5t-203.5 84.5h-224q-16 0-24.5-1t-19.5-5-16-14.5-5-27.5v-239q0-97-52-142 57-6 102.5-18t94-39 81-66.5 53-105 20.5-150.5q0-121-79-206 37-91-8-204-28-9-81 11t-92 44l-38 24q-93-26-192-26t-192 26q-16-11-42.5-27t-83.5-38.5-86-13.5q-44 113-7 204-79 85-79 206 0 85 20.5 150t52.5 105 80.5 67 94 39 102.5 18q-40 36-49 103-21 10-45 15t-57 5-65.5-21.5-55.5-62.5q-19-32-48.5-52t-49.5-24l-20-3q-21 0-29 4.5t-5 11.5 9 14 13 12l7 5q22 10 43.5 38t31.5 51l10 23q13 38 44 61.5t67 30 69.5 7 55.5-3.5l23-4q0 38 .5 103t.5 68q0 22-11 33.5t-22 13-33 1.5h-224q-119 0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5 84.5t84.5 203.5z" />

                <metadata>
                    <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
                        xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#" xmlns:dc="http://purl.org/dc/elements/1.1/">
                        <rdf:Description about="https://iconscout.com/legal#licenses"
                            dc:title="Github, Online, Project, Hosting, Square"
                            dc:description="Github, Online, Project, Hosting, Square" dc:publisher="Iconscout"
                            dc:date="2016-12-14" dc:format="image/svg+xml" dc:language="en">
                            <dc:creator>
                                <rdf:Bag>
                                    <rdf:li>Font Awesome</rdf:li>
                                </rdf:Bag>
                            </dc:creator>
                        </rdf:Description>
                    </rdf:RDF>
                </metadata>
            </svg>
        </a>
    </span>
    

    
    <span class="px-1">
        <a href="https://www.linkedin.com/in/thanh-thi%E1%BB%87n-tr%E1%BA%A7n-379623301/" target="_blank" aria-label="linkedin">
            <svg xmlns="http://www.w3.org/2000/svg" width='2.4em' height='2.4em' fill="#fff" aria-label="LinkedIn"
                viewBox="0 0 512 512">
                <rect width="512" height="512" fill="#0077b5" rx="15%" />
                <circle cx="142" cy="138" r="37" />
                <path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198" />
                <path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32" />
            </svg>
        </a>
    </span>
    

    

    

    
    <a href="https://www.facebook.com/thanh.thien.698912" target="_blank" aria-label="facebook">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="48px" height="48px">
            <path fill="#3F51B5"
                d="M42,37c0,2.762-2.238,5-5,5H11c-2.761,0-5-2.238-5-5V11c0-2.762,2.239-5,5-5h26c2.762,0,5,2.238,5,5V37z" />
            <path fill="#FFF"
                d="M34.368,25H31v13h-5V25h-3v-4h3v-2.41c0.002-3.508,1.459-5.59,5.592-5.59H35v4h-2.287C31.104,17,31,17.6,31,18.723V21h4L34.368,25z" />
        </svg>
    </a>
    
</div><div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-4 text-center">
            
                <div class="pb-2">
                    <a href="https://ThienIT84.github.io/NetworkingPrograming/" title="Trần Thanh Thiện - AI Engineer Portfolio">
                        <img alt="Footer logo" src="/NetworkingPrograming/fav.png"
                            height="40px" width="40px">
                    </a>
                </div>
            
            &copy; 2025  © 2025 Trần Thanh Thiện. All rights reserved.
            <div class="text-secondary">
                Made with
                <span class="text-danger">
                    &#10084;
                </span>
                and
                <a href="https://github.com/gurusabarish/hugo-profile" target="_blank"
                    title="Designed and developed by gurusabarish">
                    Hugo Profile
                </a>
            </div>
        </div>
    </div>
</div>
</footer><style>
     
    .lang-switch-container {
        position: fixed;
        bottom: 30px;
        right: 30px;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        gap: 10px;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    .lang-switch-btn {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: white;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        border: 2px solid transparent;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 14px;
        color: #333;
        transition: all 0.3s ease;
        text-decoration: none !important;
        position: relative;
        overflow: hidden;
    }

    .lang-switch-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
    }

    .lang-switch-btn.active {
        background: #2563eb;
        color: white;
        border-color: #2563eb;
        pointer-events: none;
    }

    .lang-switch-btn img {
        width: 24px;
        height: auto;
    }

     
    .lang-switch-btn::before {
        content: attr(data-lang);
        position: absolute;
        right: 60px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s;
        white-space: nowrap;
    }

    .lang-switch-btn:hover::before {
        opacity: 1;
    }

     
    @media (prefers-color-scheme: dark) {
        .lang-switch-btn {
            background: #1e293b;
            color: #e2e8f0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        .lang-switch-btn.active {
            background: #06b6d4;
            color: white;
            border-color: #06b6d4;
        }
    }
</style>

<div class="lang-switch-container">
    
    
    
    

    
    
    
    
    
    

    
    

    <a href="/NetworkingPrograming/blogs/java-multi-threading-socket/" class="lang-switch-btn active"
        data-lang="Tiếng Việt">
        VI
    </a>
    
    
    

    
    
    
    

    
    
    
    
    
    
    
    
    
    

    <a href="/NetworkingPrograming/en/" class="lang-switch-btn "
        data-lang="English">
        EN
    </a>
    
</div><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
        integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
        crossorigin="anonymous"></script>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.documentElement.classList.add('dark');
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
        document.documentElement.classList.remove('dark');
    } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.classList.add('dark');
        document.body.classList.add('dark');
    }

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            document.documentElement.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            document.documentElement.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    })

</script>












    <section id="search-content" class="py-2">
        <div class="container" id="search-results"></div>
    </section>
</body>

</html>